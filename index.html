<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAaUlEQVR4AWPAClyuNqAKrPr/CFVg//89qAI3/k9EFXjx3x+FL/j/P6oC+//PUQUa/p9GFVj6fyqqwPn/uagCb/9zAF1bufDwPAhf+///+v0//wPBdxawgCWI/XRDY3qmDsyWrWVAJi4AAPbHLVcmYZFgAAAAAElFTkSuQmCC" rel="icon" type="image/png" />
  <title>J'Optimisme</title>
<style>button,hr,input{overflow:visible}progress,sub,sup{vertical-align:baseline}[type=checkbox],[type=radio],legend{box-sizing:border-box;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style>
<style>
html, body {
  background: black;
  color: white;
}

body {
  margin: 20px auto;
  width: 100%;
  max-width: 780px;
}

#header {
  width: 100%;
  background-size: 100%;
  background-position: 0 -0.1%;
  padding-top: 26.85%;
  background-color: black;
  position: relative;
  z-index: 1000;
}

#menu {
  text-align: right;
  padding-top: 10%;
  background-size: 63%;
  background-repeat: no-repeat;
  background-position: 100% 82%;
}

#menu div {
  text-align: center;
  display: inline-block;
  padding-bottom: 13%;
  cursor: pointer;
  transition: all .3s cubic-bezier(0, 1.15, 1, 1);
  background-color: transparent;
  mix-blend-mode: multiply;
}

#menu div:hover { background-color: rgba(0, 0, 0, 0.3) }

@supports (mix-blend-mode: multiply) {
  #menu div:hover {
    background-color: #c65230;
  }
}

#links { width: 15% }
#subscribe { width: 25% }
#contact { width: 22% }

#logo-text {
  display: block;
  width: 100%;
  height: 98%;
  background-size: 66%;
  background-repeat: no-repeat;
  top: -22%;
  position: absolute;
  right: -2.2%;
  background-position: right;
  cursor: pointer;
  transition: all .3s cubic-bezier(0, 1.15, 1, 1);
}

#logo-text:hover { filter: grayscale(1) }

#logo-face {
  display: block;
  position: absolute;
  height: 200%;
  width: 43%;
  background-size: 100%;
  top: -43%;
  background-repeat: no-repeat;
  left: -6.7%;
  display: inline-block;
}

#logo-slogan {
  width: 95%;
  padding-bottom: 15%;
  position: absolute;
  top: 67%;
  background-position: right;
  background-size: contain;
  background-repeat: no-repeat;
}

#container {
  width: 100%;
  background: white;
  background-size: 100%;
  background-position: top;
  padding-top: 12%;
  padding-bottom: 6%;
  position: relative;
  top: -1px;
}

#bottom-border {
  padding-top: 12%;
  width: 100%;
  background-size: 100%;
  background-repeat: no-repeat;
  background-position: bottom;
  position: absolute;
  bottom: 0;
}

#footer {
  padding-bottom: 16%;
  background-size: 100%;
  width: 100%;
  background-repeat: no-repeat;
  background-position: bottom;
  cursor: not-allowed;
}

a.link, .article, .contact, .subscribe {
  display: block;
  width: 90%;
  background-color: white;
  margin: 0 auto 20px;
  box-sizing: border-box;
  background-position: center;
  background-repeat: no-repeat;
  position: relative;
  display: none;
}
.contact { text-align: center }

.contact img { width: 50% }
.subscribe img { width: 100%; height: 100%; }
.article img {
  width: 100%;
  position: absolute;
  top: 0;
}

a.link { background-size: 100% }
a.link:hover {
  background-color: #c85230;
  background-blend-mode: screen;
}

/* ROUTING */
.page-home #logo-text { cursor: default }
.page-home #logo-text:hover { filter: none }

.page-home .article { display: inherit }
.page-contact .contact { display: inherit }
.page-subscribe .subscribe { display: inherit }
.page-links a.link { display: block }

.page-links #links,
.page-subscribe #subscribe,
.page-contact #contact {
  background: rgba(0, 0, 0, 0.3)!important;
  cursor: default;
}

/* IMAGES */
#footer { background-image: url('./img/footer-message.gif') }
#header { background-image: url('data:image/gif;base64,R0lGODlhDAPWAKIAAAAAAS4pRYaCl1pWdMvI3v///+fl8ammvSH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCNkVENTFFOTM2NTUxMUU4ODlCREExM0EzMUEyQUMzRCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCNkVENTFFQTM2NTUxMUU4ODlCREExM0EzMUEyQUMzRCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkI2RUQ1MUU3MzY1NTExRTg4OUJEQTEzQTMxQTJBQzNEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkI2RUQ1MUU4MzY1NTExRTg4OUJEQTEzQTMxQTJBQzNEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Af/+/fz7+vn49/b19PPy8fDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M/OzczLysnIx8bFxMPCwcC/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwLCgkIBwYFBAMCAQAAIfkEAAAAAAAsAAAAAAwD1gAAA/8Iutz+MMpJq7046827/2AojmRpnmiqrmzrvnAsz3Rt33iu73zv/8CgcEgsGo/IpHLJbDqf0Kh0Sq1ar9isdsvter/gsHhMLpvP6LR6zW673/C4fE6v2+/4vH7P7/v/gCoBCwGFAIaHg4QbhogQioGRkpOUW4WFA5gDBwICB58EnASjpKQHo6cGqgakrKChnZudArACAwO2uJ6fnr25twGZiZCSxFLGDcSXi8kPwR3IldLT0MOXmcG6sqcErKoF4OHi4+Tl5ufo6eeq3ey+v5eDyw7RZ/U9joTyzIrIjZvCgAXwdAsbMF29EBaMlW1eI2oQ90Dal2iANQAKN3H69Or/mwFyH9WJHEmypEmSH9lx7MSpYLxg9+gZa6QsphuazIYtzKRN16hYs3Tx4kigwKhVIQsgPSluFdFOsAxiw8TAZsQYU7Mh3FU0lSleLG1ZfTMRk9ZYGk8RbeetXYFPSuOGTMq0rt27ePOKTPmxW6iVuA5aHBgPo0Vchw4hhqlIQFVni5Tpm6pg4uPKhQsruNUM47xhEp7p7NcwsFBu3ZR+i8tar2umq5H+ZPgZ8lURtFrRfa2a1a4Dt2bRHrtDciLMLwtu5ZjK1Wre0KNLn04ddlFWfg2AYr5x5SzgwLPlehlP4FSWLQ0RBNBp2TWDDHnKYuwS2K/gwYHmJxB2o6fs/6lVJ+CA4fjmkiOOlSBPMLYw5McABNbFzlH8/dfWT8yt4hcqQTG2oHLodcfdURq2c1RvEaao4oostmhSUnx9Q+GEq4BTCluq9RZKKdwcwM5SJAI5So4oumjkkea4whF+gp21UIioNPfcONqRsosAxJlxAJJc1sjll2CGKeaYZJZp5plIqjTeGgGg6eabcMYp55x01mknma4QJBBoXmx555+ABirooIQWamiEsWE3Wy7CASdcg+9w89+OpkTJlV8HqCDAoZx26umnoIYq6qgkEaCCn6SmquqqrLbq6quuWZQCqrDWauutuOaqa5yyogDhrsAGK+ywxBZLUq8nbGrssv/MNuvss55mucGv0FZr7bXYZtsisia0qe234IYr7rjmcKvgbuSmq+667OJqLgnetivvvPTWe2imKqBr77789usvkvimUNS/BBds8MGvmXoqwgw37PDD4SicgrIQV2zxxe1KjEK8GHfs8cfVrsAxyCSXbDKu0m5w8sost0xqyhro6/LMNNccJ8wZ0Grzzjz3/CXOGFDs89BEF11dgilQa/TSTDd9EtK+Oi311FSPA/UJI1et9dY9B7yxzFyHLXbJGqMw8Nhop/2xASzorPbbcDMM9AVCx2333f2yUDfefPe97twW7O334IRnC3gFWReu+OLMHk5B4oxHLrmu75YA9uT/mGeu6tUnnK3556CPWjkJbodu+umDcm6C4Ki37rqcqpeg9Ou0137m6CNAbvvuvLuIuwi69y788EezEDzxyCefV+zwKu/883r9LsLl0FdvvdUtUH/99tAzT4L23IePvPQheC7++c97P4L56LdPvPohBAC++/Sj7rXA9effe9lm6+9/7fw7Qen+R8DPtWCABUyg5BxHAfYp8IGMI98HHAjBCg7ufgK0oAYVh0ETUHCDIHwb/D4gvxCa8G4dJMHsTsjCsQWQBKxroQypxjYVrHCGOJSaARgYgRvm8IdL4yEEYgjEIvZMghwgohGXSDMkTouJUPSZEzXgwyha8WQj7EAV/6/IxY+lEDddDOPJXghGMZpxbQs7oxovRsYQbHGNcPxXG0EwvzjacV473Ngd93gwITpAiXwM5N8mJshC2muKGECgIRcZLkRaIACKZKQkseXICgBykph8VhY1EIAPZvKTzfoiCT0JylISS5QeKKEpVxlKPbLylcaaowfqCMtarqqG3bKlLneFSwXt8pcoQwEtgUnMQ/mRAcMspjIFdczKLPOZpKrkBDoJzWp+qpmHsKY2OSVNCbxxm+CUUzcjcLxwmtNNm8RAOc/JTjKl8wLrbKc8v/ROC3xznvg80jghcM98+nNF9UTcPwcKJlRyIJ4ETeh0Avo4hTqURQydQD8fSv/RvBiUERXNaHUuyslkavSj6YhoaEBKUteIlJweLalKwXHSCJBypTAlxz4hkNKYghSbqrSpTs8xU3rs9KfmwGlNgfrQnjpgqERVqFEbgNSkEnSpyHQqUbEJgKZK1Z9UtepV8UnVl241o139qk6FKlabUjWSZaVoVtMKU7KyVaVhfWtJ4yrXm/avriBNgVbxak298nVmez0ZXf+6ssCazK2EVaswE0vRPHaOsYrNIGQdetbJUvauln0qCtCaWXNWtrMDpeolQbtNqC5gtKS1pmhT60/TKgC1rH3mZ2MrT9eyh7bzbOkQcVtbFMCWt8C07W+Bu0vhEvectuXscYGp2wf/eHW5v+SoBp4LXV021wHUrW4tr9uA7Gr3ldxlgHe/u8rwLsCw5BWkeRUw3vSCcr0AUK57y+vb+S4TvvK173vrq19iwne4/ZUkfgPMXP4SWJerPTCCN6tgXRq3wbV8MIRfmeAJs7LCFjalhDNcyg1z+JMY/nAmQyziSZK4xIw8MYoNqeIVC3K2Lk4xg2MsyVnRmJGOXd2NF9nLEgB4x1aUZQfyC2QuCjmJRRZkj2GY5BfPuMl7HCyU4bjk9U35jlUWAZGvbMQsl4/LcfQyCNoL5h/ir8xqFPMH0IvmCh65o20+45szgNA4/1DN0LCzGaVLZz2LEb519rMMAS3oLv63HdBctO1EEc1CRTPailRd9KNDKE3yvOTHk66gExMAADs=') }
#container { background-image: url('./img/contour.gif') }
#logo-text { background-image: url('./img/leandre-signe.png') }
#bottom-border { background-image: url('./img/contour-bottom.png') }
.article { background-image: url('./img/sablier.gif') }

.png #logo-face { background-image: url('./img/leandre-portrait.png') }
#logo-slogan { background-image: url('./img/joptimisme.png') }
#menu { background-image: url('./img/onglets.gif') }

.webp #logo-face { background-image: url('./img/leandre-portrait.webp') }

.png #lien-decroissance { background-image: url('./img/lien-decroissance.png'); }
.png #lien-niquezvosmeres { background-image: url('./img/lien-niquezvosmeres.png'); }
.png #lien-rodong-sinmun { background-image: url('./img/lien-rodong-sinmun.png'); }
.webp #lien-decroissance { background-image: url('./img/lien-decroissance.webp'); }
.webp #lien-niquezvosmeres { background-image: url('./img/lien-niquezvosmeres.webp'); }
.webp #lien-rodong-sinmun { background-image: url('./img/lien-rodong-sinmun.webp'); }

@media
only screen and (-webkit-min-device-pixel-ratio: 2),
only screen and ( min--moz-device-pixel-ratio: 2),
only screen and ( -o-min-device-pixel-ratio: 2/1),
only screen and ( min-device-pixel-ratio: 2),
only screen and ( min-resolution: 192dpi),
only screen and ( min-resolution: 2dppx) {
  #logo-text { background-image: url('./img/x2/leandre-signe.png') }
  #logo-slogan { background-image: url('./img/x2/joptimisme.png') }
  .png #logo-face { background-image: url('./img/x2/leandre-portrait.png') }
  .webp #logo-face { background-image: url('./img/x2/leandre-portrait.webp') }
  .png #lien-decroissance { background-image: url('./img/x2/lien-decroissance.png'); }
  .png #lien-niquezvosmeres { background-image: url('./img/x2/lien-niquezvosmeres.png'); }
  .png #lien-rodong-sinmun { background-image: url('./img/x2/lien-rodong-sinmun.png'); }
  .webp #lien-decroissance { background-image: url('./img/x2/lien-decroissance.webp'); }
  .webp #lien-niquezvosmeres { background-image: url('./img/x2/lien-niquezvosmeres.webp'); }
  .webp #lien-rodong-sinmun { background-image: url('./img/x2/lien-rodong-sinmun.webp'); }
}

#sub-box {
  background-image: url('./img/s-abonner.gif');
  background-size: 100%;
  padding: 4.7% 0;
  background-repeat: no-repeat;
  background-position: center;
  text-align: right;
}

input[type="email"]:focus {
  outline: none;
  background-color: aliceblue;
}

input[type="submit"] {
  background-color: transparent;
  border-color: transparent;
  mix-blend-mode: screen;
  padding: 1.6% 10.4%;
  margin-right: 3%;
  cursor: pointer;
}

input[type="submit"]:focus, input[type="submit"]:hover {
  background-color: #c95130;
}

input[type="email"] {
  font-size: 22px;
  line-height: 37px;
  margin: 0;
  width: 46%;
  margin-right: 4.8%;
  margin-top: 7.4%;
  background: transparent;
  border: none;
  margin-bottom: 1.6%;
  mix-blend-mode: multiply;
  padding-left: 2%;
  font-family: monospace;
}

@media (max-width: 780px) {
  input[type="email"] {
    font-size: 2.8vw;
    line-height: 5vw;
  }
}

</style>
</head>
<body>
<div id="menu">
  <div onclick="goTo('contact')" id="contact"></div>
  <div onclick="goTo('subscribe')" id="subscribe"></div>
  <div onclick="goTo('links')" id="links"></div>
</div>
<div id="header">
  <div id="logo-slogan"></div>
  <div onclick="goTo('home')" id="logo-text"></div>
  <div id="logo-face"></div>
</div>
<div id="container">
  <div class="subscribe">
    <form id="sub-box">
      <input type="email" spellcheck="false" id="email">
      <div><input type="submit" value=""></div>
    </form>
    <img width="702" height="235" src="/img/grand-prix.gif"></img>
  </div>
  <div class="contact">
    <a id="mail-link" href="mailto:nospam@inbox.ru">
      <img src="/img/mail.gif"></img>
    </a>
    <img src="/img/poste.gif"></img>
  </div>
  <a class="link" target="_blank" href="http://www.ladecroissance.net" id="lien-decroissance" style="padding-top: 29%"></a>
  <a class="link" target="_blank" href="https://niquez-vos-meres.github.io" id="lien-niquezvosmeres" style="padding-top: 22%"></a>
  <a class="link" target="_blank" href="http://www.rodong.rep.kp/en/" id="lien-rodong-sinmun" style="padding-top: 22%"></a>
  <!-- ⚡ -->
  <!-- <div class="article" id="Espace" --data-date="1525684315781" style="padding-top: 83.1589%"></div> -->
  <!-- <div class="article" id="Victime" --data-date="1525684290987" style="padding-top: 76.2000%"></div> -->
  <div class="article" id="4G" --data-date="1525684114019" style="padding-top: 88.6734%"></div>
  <div class="article" id="Perdu" --data-date="1525684114019" style="padding-top: 83.4669%"></div>
  <div class="article" id="Marche" --data-date="1525626507990" style="padding-top: 75.6453%"></div>
  <div class="article" id="parkings" --data-date="1525626507990" style="padding-top: 122.4340%"></div>
  <div class="article" id="tourisme-humanitaire" --data-date="1524571920630" style="padding-top: 76.3473%"></div>
  <div class="article" id="Bombardement" --data-date="1524571920630" style="padding-top: 141.8236%"></div>
  <div class="article" id="Vinci-Aeroport" --data-date="1523967120630" style="padding-top: 76.2108%"></div>
  <div class="article" id="Diners-romantique" --data-date="1523967120630" style="padding-top: 77.0655%"></div>
  <div class="article" id="GPA" --data-date="1522757520630" style="padding-top: 135.1852%"></div>
  <div class="article" id="snapchat" --data-date="1522757520630" style="padding-top: 138.4615%"></div>
  <div class="article" id="surveillance" --data-date="1523362320630" style="padding-top: 142.1652%"></div>
  <div class="article" id="L-AUTO-C-EST-LA-LIBERTE" --data-date="1523362320630" style="padding-top: 115.3846%"></div>
  <div class="article" id="SUV" --data-date="1521547920630" style="padding-top: 79.6296%"></div>
  <div class="article" id="LINKY" --data-date="1521547920630" style="padding-top: 73.9316%"></div>
  <div class="article" id="montagneg" --data-date="1520943120630" style="padding-top: 76.2108%"></div>
  <div class="article" id="cop23" --data-date="1520943120630" style="padding-top: 112.8205%"></div>
  <div class="article" id="Huline" --data-date="1520338320630" style="padding-top: 104.6486%"></div>
  <div class="article" id="lotissementc" --data-date="1520338320630" style="padding-top: 75%"></div>
  <div class="article" id="marche-de-noel" --data-date="1519733520630" style="padding-top: 70.3804%"></div>
  <div id="bottom-border"></div>
</div>
<div id="footer"></div>
<img id="web-p" style="visibility: hidden;" src="data:image/webp;base64,UklGRi4AAABXRUJQVlA4TCEAAAAvAUAAEB8wAiMwAgSSNtse/cXjxyCCmrYNWPwmHRH9jwMA">
<script type="text/javascript">
"use strict"

Object.keys || (Object.keys = function (s) {var k,a=[];for (k in s){a.push(k)}})
var prev, r, mainElement, timeout
var mailLink = document.getElementById('mail-link')
var subBox = document.getElementById('sub-box')
var webPEl = document.getElementById('web-p')
var webP = webPEl.height === 2
var page = window.location.search.slice(1) || 'home'
var x2 = window.devicePixelRatio > 1 ? 'x2/' : ''
var api = 'https://ci-flyqbaosvc.now.sh'
var articlesById = {}, requested = {}, loaded = {}
var forEach = [].forEach, map = [].map

webPEl.remove()

mailLink.href = mailLink.href.replace('nospam', 'lemo')

document.body.classList.add(webP ? 'webp' : 'png')
document.body.classList.add('page-'+ page)

function get(url, cb) {
  var req = new XMLHttpRequest()
  req.onreadystatechange = function () {
    this.readyState === XMLHttpRequest.DONE && cb.call(this, this)
  }
  req.open('GET', url, true)
  req.send(null)
  return req
}

function scrollTop() {
  return (document.scrollingElement || document.documentElement).scrollTop
}

function goTo(newPage) {
  if (newPage === page) return
  document.body.classList.remove('page-'+ page)
  document.body.classList.add('page-'+ newPage)
  page = newPage
  mainElement = undefined
  if (page === 'home') {
    history.replaceState({}, '', '/')
    return setTimeout(recalcPositions)
  }
  history.replaceState({}, '', '?'+ page)
}

function readystatehandler(req) {
  if (req.status !== 200) {
    subBox.style.backgroundImage = "url('./img/s-abonner.gif')"
    subBox.style.backgroundSize = '100%'
    forEach.call(subBox.getElementsByTagName('input'), function (input) {
      input.disabled = false
      input.style.visibility = ''
    })
    return console.error(req.status, req.statusText)
  }
  console.log(req.responseText)
  subBox.style.backgroundImage = "url('./img/confirmation-abonnement.gif')"
  subBox.style.backgroundSize = '70%'
}

subBox.addEventListener('submit', function (event) {
  event.preventDefault()
  subBox.style.backgroundImage = "url('./img/sablier.gif')"
  subBox.style.backgroundSize = '10%'
  forEach.call(subBox.getElementsByTagName('input'), function (input) {
    input.disabled = true
    input.style.visibility = 'hidden'
  })
  var email = document.getElementById('email').value
  get(api +'/sub?email='+ email, readystatehandler)
})

var articles = map.call(document.getElementsByClassName('article'),
  function (el) { return { el: el, id: el.id } })

function refreshBouding(a) {
  var rect = a.el.getBoundingClientRect()
  a.height = rect.height
  a.top = scrollTop() + rect.top
  a.bottom = (scrollTop() + rect.top) + rect.height
}

function processArticle(a, i, all) {
  refreshBouding(a)
  a.next = all[(i + 1) % all.length]
  articlesById[a.id] = a
}

articles.forEach(processArticle)

get('https://joptimisme.github.io/?'+ +(new Date), function (req) {
  var parser = new DOMParser()
  var doc = parser.parseFromString(req.responseText, 'text/html')
  var container = document.getElementById('container')
  var fresh = map
    .call(doc.getElementsByClassName('article'), function (el) { return el })
    .filter(function (el) { return !articlesById[el.id] })
    .reverse()

  fresh.forEach(function (el) {
    container.prepend(el)
    articles.unshift({ el: el, id: el.id })
  })

  fresh.length && articles.forEach(processArticle)
  fresh.length && recalcPositions()

  var apiId = doc.getElementsByTagName('script')[0]
    .innerText.split(/api = 'https:\/\/([^.]+)\.now\.sh'/)[1]

  apiId && (api = 'https://'+ apiId +'.now.sh')
})

function loadImage(a) {
  if (requested[a.id]) return
  requested[a.id] = true

  document.getElementById(a.id).innerHTML = '<picture>'
    + '<source srcset="img/'+ x2 + a.id +'.webp" type="image/webp">'
    + '<source srcset="img/'+ x2 + a.id +'.png" type="image/png">'
    + '<img alt="'+ a.id +'" onload="loadNext(\''+ a.id +'\')" />'
  + '</picture>'
}

function updateHash() {
  if (!mainElement || mainElement === prev) return
  prev = mainElement
  history.replaceState({}, '', '#'+ mainElement.id)
}

function notLoaded(r) { return !loaded[r] }
function loadNext(id) {
  loaded[id] = true
  var imageLoading = Object.keys(requested).filter(notLoaded)
  if (imageLoading.length) return

  var next = articlesById[id].next
  while (loaded[next.id]) {
    if (next.id === id) return
    next = next.next
  }
  loadImage(next)
}

function update() {
  r = undefined
  if (timeout) return
  var top = scrollTop()
  var bottom = top + innerHeight
  var inView = articles.filter(function (a) {
    return a.bottom > top && a.top < bottom
  })

  var [ first, second ] = inView
  if (!second) {
    mainElement = first
  } else if (first.top >= top) {
    mainElement = first
  } else if ((first.bottom - top) / first.height > (bottom - second.top) / second.height) {
    mainElement = first
  } else {
    mainElement = second
  }

  inView.forEach(loadImage)
}

function updateOnTick() { r || (r = setTimeout(update, 80)) }
function recalcPositions() {
  timeout = undefined
  articles.forEach(refreshBouding)
  updateOnTick()
}

addEventListener('scroll', updateOnTick, false)
addEventListener('resize', function () {
  clearTimeout(timeout)
  timeout = setTimeout(recalcPositions, 500)
}, false)

setTimeout(update)
setInterval(updateHash, 80)
</script>
</body>
</html>
